<?php
/**
 * @file
 * Code for the Commons Follow (Individual nodes) feature.
 */

include_once 'commons_follow_node.features.inc';


function commons_follow_node_get_message_ids(&$followed_mids, $followed_content = array()) {
  // Generate a list of message IDs where the target nodes are followed by
  // the current user.
  $result = db_query("SELECT m.mid AS mid FROM {message} m INNER JOIN {field_data_field_target_nodes} tn ON m.mid=tn.entity_id WHERE tn.field_target_nodes_target_id IN (:nids)", array(':nids' => array_values($followed_content['commons_follow_node'])));
  foreach ($result as $this_result) {
    $followed_mids[] = $this_result->mid;
  }
}

// When Commons Notify is enabled, return a list of UIDs that shuld be notified
// about a particular message.
function commons_follow_users_to_notify($message) {
  //Return the appropriate query depending on message type...
  //$result = db_query("SELECT fc.uid FROM {flag_content} fc WHERE fc.content_type = 'node" AND fc.content_id = :nid;
}